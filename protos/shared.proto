syntax = "proto3";

message EmptyMessage {
}

message Timestamp {
        int32 epoch = 1;
}

message IntMessage {
        int32 value = 1;
}

message Signature {
        bytes serializedData = 1;
        string signature = 2;
}

message Hash {
        bytes serializedData = 1;
        string hash = 2;
}

message Candidate {
        string name = 1;
}

message Election {
        string description = 1;
        map<int32, Candidate> candidates = 2; // candidate id => candidate
}

message ElectionMetadata {
        Timestamp electionStart = 1;
        Timestamp electionEnd = 2;
        map<int32, Election> elections = 3; // election id => election
}

message SignedElectionMetadata {
        ElectionMetadata electionMetadata = 1;
        Signature signature = 2;
}

message ProposedBallot {
        int32 voterDeviceId = 1;
        Timestamp castAt = 2;
        map<int32, int32> candidateChoices = 3; // election id => candidate id
}

message SignedProposedBallot {
        ProposedBallot proposedBallot = 1;
        Signature signature = 2;
}

message RecordedBallot {
        SignedProposedBallot signedProposedBallot = 1;
        Timestamp recordedAt = 2;

        Signature voteServerSignature = 3;
}

message SignedRecordedBallot {
        RecordedBallot recordedBallot = 1;
        Signature signature = 2;
}

message TreeNode {
        SignedRecordedBallot signedRecordedBallot = 1;
        repeated Hash childrenHashes = 2;
}

message HashedTreeNode {
        TreeNode treeNode = 1;
        Hash hash = 2;
}       

message Tree {
        HashedTreeNode root = 1;
        
        Tree left = 2;
        Tree right = 3;
}

message SignedTree {
        Tree tree = 1;
        Signature signature = 2;
}
